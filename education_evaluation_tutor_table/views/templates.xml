<?xml version="1.0" encoding="utf-8"?>
<odoo>
   <template id="assets_frontend" name="Evaluation tutor table assets" inherit_id="website.assets_frontend">
      <xpath expr="." position="inside">
         <link type="text/scss" href="/education_evaluation_tutor_table/static/src/css/style.css" rel="stylesheet"/>
         <script type="text/javascript" src="/education_evaluation_tutor_table/static/src/js/script.js"/>
      </xpath>
   </template>
   <template id="portal_meetings" inherit_id="portal.portal_my_home" name="Portal My Home : tutor meeting entries">
      <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
         <t t-call="portal.portal_docs_entry">
            <t t-set="title">Meetings</t>
            <t t-set="url" t-value="'/meetings'" />
            <t t-set="count" t-value="meetings_count" />
         </t>
      </xpath>
   </template>
   <template id="student_meetings_table" name="Teacher Student Meetings">
      <t t-call="website.layout">
         <xpath expr="//div[@id='wrap']" position="replace">
            <div class="oe_structure"
               id="oe_structure_website_event_index_1" />
            <div class="container">
               <!-- Browser -->
               <div class="row mt8">
                  <div class="col-md-12">
                     <ol class="breadcrumb mb0">
                        <li class="breadcrumb-item">
                           <a href="/schedules">Meetings</a>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="row mt32 mb32">
                  <div class="col-lg-12" id="middle_column">
                     <div class="o_portal_my_home">
                        <div class="oe_structure" id="oe_structure_portal_my_home_1"
                           data-oe-model="ir.ui.view" data-oe-id="599"
                           data-oe-field="arch" data-oe-xpath="/t[1]/t[1]/div[1]/div[1]">
                        </div>
                        <div class="o_portal_docs list-group">
                           <t t-if="meetings">
                             <div>
                                <form id="real_done">
                                   <div class="button-group text-center">
                                       <input id="changed_input_ids" name="changed_input_ids" hidden="true"/>
                                       <button id="save_schedule_btn" type="submit" class="save_button btn btn-primary ml-2 mb-2">
                                          Save changes <i class="fa fa-save"></i>
                                       </button>
                                   </div>
                                </form>
                                <div>
                                      <table class="table_tutor_meetings">
                                         <thead>
                                             <tr>
                                                <th/>
                                                <t t-foreach="evaluations" t-as="evaluation">
                                                   <t t-foreach="evaluation_months[evaluation]" t-as="month">
                                                      <th colspan="6" class="month_th text-center">
                                                         <t t-esc="months_str[month]"/>
                                                      </th>
                                                   </t>
                                                   <th colspan="6" class="eval_th text-center">
                                                      <t t-esc="evaluations_str[evaluation]"/>
                                                   </th>
                                                </t>
                                             </tr>
                                            <tr>
                                               <th/>
                                               <t t-foreach="evaluations" t-as="evaluation">
                                                  <t t-foreach="evaluation_months[evaluation]" t-as="month">
                                                     <th colspan="3" class="student_th text-center">
                                                         Student
                                                     </th>
                                                     <th colspan="3" class="parent_th text-center">
                                                         Parent
                                                     </th>
                                                  </t>
                                                  <th colspan="3" class="student_th text-center">
                                                     Student
                                                  </th>
                                                  <th colspan="3" class="parent_th text-center">
                                                     Parent
                                                  </th>
                                               </t>
                                            </tr>
                                            <tr>
                                                <th/>
                                                <t t-foreach="evaluations" t-as="evaluation">
                                                   <t t-foreach="evaluation_months[evaluation]" t-as="month">
                                                      <t t-call="education_evaluation_tutor_table.meetings_th_group"/>
                                                   </t>
                                                   <t t-call="education_evaluation_tutor_table.meetings_th_group"/>
                                                </t>
                                            </tr>
                                         </thead>
                                         <tbody>
                                            <tr t-foreach="students" t-as="student">
                                               <t t-set="student_meetings" t-value="meetings.filtered(lambda m: m.student_id == student)"/>
                                               <td class="td_student_name"><t t-esc="student.display_name"/></td>
                                               <t t-foreach="evaluations" t-as="evaluation">
                                                  <t t-set="student_meetings_planned" t-value="student_meetings.filtered(lambda m: m.state in ['draft','open', 'done'] and m.eval_type==evaluation)"/>
                                                  <t t-set="student_meetings_done" t-value="student_meetings.filtered(lambda m: m.state == 'done' and m.eval_type==evaluation)"/>
                                                   <t t-foreach="evaluation_months[evaluation]" t-as="month">
                                                      <t t-set="student_meetings_planned_month" t-if="student_meetings_planned" t-value="student_meetings_planned.filtered(lambda m: m.start_datetime.month  == month)"/>
                                                      <t t-set="student_meetings_done_month" t-if="student_meetings_done" t-value="student_meetings_done.filtered(lambda m: m.start_datetime.month  == month)"/>
                                                      <t t-call="education_evaluation_tutor_table.meetings_td_group">
                                                         <t t-set="planned_nr" t-value="student_meetings_planned_month"/>
                                                         <t t-set="done_nr" t-value="student_meetings_done_month"/>
                                                         <t t-set="td_student" t-value="student"/>
                                                         <t t-set="td_eval" t-value="evaluation"/>
                                                         <t t-set="td_month" t-value="month"/>
                                                      </t>
                                                   </t>
                                                  <t t-call="education_evaluation_tutor_table.meetings_td_group">
                                                      <t t-set="planned_nr" t-value="student_meetings_planned"/>
                                                      <t t-set="done_nr" t-value="student_meetings_done"/>
                                                      <t t-set="td_student" t-value="student"/>
                                                      <t t-set="td_eval" t-value="evaluation"/>
                                                      <t t-set="td_month" t-value="0"/>
                                                  </t>
                                               </t>
                                            </tr>
                                         </tbody>
                                      </table>
                                </div>
                             </div>
                           </t>
                           <t t-else="">
                              <h2>
                                 No meetings found
                              </h2>
                           </t>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </xpath>
      </t>
   </template>
   <template id="meetings_th_group" name="Meetings header group">
      <th class="meeting_th text-center">
         Planned
      </th>
      <th class="meeting_th text-center">
         Done
      </th>
      <th class="meeting_th text-center real_done_td">
         Real done
      </th>
      <th class="meeting_th text-center">
         Planned
      </th>
      <th class="meeting_th text-center">
         Done
      </th>
      <th class="meeting_th text-center real_done_td">
         Real done
      </th>
   </template>
   <template id="meetings_td_group" name="Meetings input group">
      <t t-set="planned_nr_student" t-if="planned_nr" t-value="planned_nr.filtered(lambda m: STUDENT_TUTORING in m.categ_ids.ids)"/>
      <t t-set="done_nr_student" t-if="done_nr" t-value="done_nr.filtered(lambda m: STUDENT_TUTORING in m.categ_ids.ids)"/>
      <td class="planned_td student_td">
         <t t-if="planned_nr_student" t-esc="len(planned_nr_student)"/>
         <t t-else="">0</t>
      </td>
      <td class="done_td student_td">
         <t t-if="done_nr_student" t-esc="len(done_nr_student)"/>
         <t t-else="">0</t>
      </td>
      <td class="real_done_td student_td"><input class="meeting_real_input" type="text" t-att-name="'%s_%s_%s_student' % (td_eval, td_student.id, td_month)"/></td>
      <t t-set="planned_nr_parent" t-if="planned_nr" t-value="planned_nr.filtered(lambda m: FAMILY_TUTORING in m.categ_ids.ids)"/>
      <t t-set="done_nr_parent" t-if="done_nr" t-value="done_nr.filtered(lambda m: FAMILY_TUTORING in m.categ_ids.ids)"/>
      <td class="planned_td parent_td">
         <t t-if="planned_nr_parent" t-esc="len(planned_nr_parent)"/>
         <t t-else="">0</t>
      </td>
      <td class="done_td parent_td">
         <t t-if="done_nr_parent" t-esc="len(done_nr_parent)"/>
         <t t-else="">0</t>
      </td>
      <td class="real_done_td parent_td"><input class="meeting_real_input" type="text" t-att-name="'%s_%s_%s_parent' % (td_eval, td_student.id, td_month)"/></td>
   </template>
</odoo>
