<?xml version="1.0" encoding="utf-8"?>
<odoo>
   <template id="assets_frontend" name="Evaluation notebook table assets" inherit_id="website.assets_frontend">
      <xpath expr="." position="inside">
         <link type="text/scss" href="/education_evaluation_notebook_table/static/src/css/style.css" rel="stylesheet"/>
            <script type="text/javascript" src="/education_evaluation_notebook_table/static/src/js/script.js"/>
      </xpath>
   </template>
   <template id="portal_schedules" inherit_id="portal.portal_my_home" name="Portal My Home : schedule entries">
      <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
         <t t-call="portal.portal_docs_entry">
            <t t-set="title">Schedules</t>
            <t t-set="url" t-value="'/schedules'" />
            <t t-set="count" t-value="schedules_count" />
         </t>
      </xpath>
   </template>
   <template id="teacher_schedule_table" name="Teacher Schedules">
      <t t-call="website.layout">
         <xpath expr="//div[@id='wrap']" position="replace">
            <div class="oe_structure"
               id="oe_structure_website_event_index_1" />
            <div class="container">
               <!-- Browser -->
               <div class="row mt8">
                  <div class="col-md-12">
                     <ol class="breadcrumb mb0">
                        <li class="breadcrumb-item">
                           Schedules
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="row mt32 mb32">
                  <!-- Central column -->
                  <div class="col-lg-12" id="middle_column">
                     <div class="o_portal_my_home">
                        <div class="oe_structure" id="oe_structure_portal_my_home_1"
                           data-oe-model="ir.ui.view" data-oe-id="599"
                           data-oe-field="arch" data-oe-xpath="/t[1]/t[1]/div[1]/div[1]"></div>
                        <div class="o_portal_docs list-group">
                           <t t-foreach="schedules" t-as="schedule">
                              <a class="list-group-item list-group-item-action d-flex align-items-center justify-content-between sm-link sm-link_text sm-link7"
                                 t-attf-href="/schedule/{{schedule.id}}/califications">
                                 <i class="fa fa-paste"></i>
                                 <span class="sm-link__label">
                                    <t t-esc="schedule.subject_id.description"/>
                                    [
                                    <t t-esc="schedule.classroom_id.description"/>
                                    ]
                                 </span>
                                 <span class="badge badge-secondary badge-pill">
                                    <t t-esc="schedule.record_count" />
                                 </span>
                              </a>
                           </t>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </xpath>
      </t>
   </template>
   <template id="schedule_calification_table" name="Teacher Schedule Table">
      <t t-call="website.layout">
         <xpath expr="//div[@id='wrap']" position="replace">
            <div class="oe_structure"
               id="oe_structure_website_event_index_1" />
            <div class="container">
               <!-- Browser -->
               <div class="row mt8">
                  <div class="col-md-12">
                     <ol class="breadcrumb mb0">
                        <li class="breadcrumb-item">
                           <a href="/schedules">Schedules</a>
                           /
                           <t t-esc="schedule.subject_id.description"/>
                           [
                           <t t-esc="schedule.classroom_id.description"/>
                           ]
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="row mt32 mb32">
                  <div class="col-lg-12" id="middle_column">
                     <div class="o_portal_my_home">
                        <div class="oe_structure" id="oe_structure_portal_my_home_1"
                           data-oe-model="ir.ui.view" data-oe-id="599"
                           data-oe-field="arch" data-oe-xpath="/t[1]/t[1]/div[1]/div[1]">
                           <t t-set="backend_url" t-value="'/web#return_label=Website&amp;model=%s&amp;id=%s&amp;action=%s&amp;view_type=form' % (schedule._name, schedule.id, schedule.env.ref('education.action_current_education_schedule').id)"/>
                           <div t-ignore="true" class="text-center mb-2">
                              This is a preview of the schedule records. <a t-att-href="backend_url"><i class="fa fa-arrow-right"/> Back to backend view</a>
                           </div>
                        </div>
                        <div class="o_portal_docs list-group">
                           <t t-if="record_lines">
                              <form>
                                 <div id="eval_buttons" class="btn-group col-lg-12">
                                    <t t-foreach="evaluations" t-as="evaluation">
                                       <a t-att-id="evaluation.eval_type" class="eval_button btn btn-primary mr-2 mb-2">
                                          <span t-field="evaluation.eval_type" />
                                       </a>
                                    </t>
                                    <a id="all" class="eval_button btn btn-primary mb-2">All</a>
                                    <button style="display:none;" id="save_schedule_btn" type="submit" class="save_button btn btn-primary ml-2 mb-2">
                                       Save changes <i class="fa fa-save"></i>
                                    </button>
<!--                                    <a t-att-href="keep(report_type='pdf')" id="action_print" class="eval_button btn btn-primary ml-2 mb-2">Print <i class="fa fa-print"></i></a>-->
                                 </div>
                                 <div id="editing_msg" class="col-lg-12" style="display:none;">
                                    <div class="text-center">
                                       <i>You are editing this table</i>
                                    </div>
                                 </div>
                                 <input id="changed_input_ids" name="changed_input_ids" hidden="true"/>
                                 <input id="changed_select_ids" name="changed_select_ids" hidden="true"/>
                              </form>
                              <table id="teacher_schedule_table">
                                 <thead>
                                    <tr>
                                       <td class="student_schedule_td"/>
                                       <t t-foreach="record_lines" t-as="line">
                                          <t t-if="line.competence_id.global_check">
                                             <t t-set="evals"
                                                t-value="record_lines.filtered(lambda r: r.parent_line_id.id == line.id)"/>
                                             <t t-foreach="evals" t-as="eval">
                                                <t t-set="competences"
                                                   t-value="record_lines.filtered(lambda r: r.parent_line_id.id == eval.id)"/>
                                                <t t-foreach="competences" t-as="competence">
                                                   <td t-att-class="'exam_schedule_td td_eval_' + exam.eval_type" t-foreach="competence.exam_ids" t-as="exam">
                                                      <t t-esc="exam.name"/> (<t t-esc="exam.eval_percent"/>%)
                                                   </td>
                                                   <td t-att-class="'comp_schedule_td td_eval_' + competence.eval_type">
                                                      <t t-esc="competence.description"/> (<t t-esc="competence.eval_percent"/>%)
                                                   </td>
                                                </t>
                                                <td t-att-class="'eval_schedule_td final_td td_eval_' + eval.eval_type">
                                                   <t t-esc="eval.competence_id.display_name"/>
                                                   <span t-field="eval.eval_type" />
                                                </td>
                                             </t>
                                             <td t-att-class="'global_schedule_td final_td td_eval_' + line.eval_type">
                                                <t t-esc="line.competence_id.display_name"/>
                                                <span t-field="line.eval_type" />
                                             </td>
                                          </t>
                                       </t>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <t t-foreach="evaluation_record_students" t-as="student">
                                       <t t-set="student_record_lines"
                                          t-value="schedule_evaluation_records.filtered(lambda r: r.student_id.id == student.id)"/>
                                       <tr>
                                          <td class="student_schedule_td">
                                             <t t-esc="student.name"/>
                                          </td>
                                          <t t-foreach="record_lines" t-as="line">
                                             <t t-if="line.competence_id.global_check">
                                                <t t-set="evals"
                                                   t-value="record_lines.filtered(lambda r: r.parent_line_id.id == line.id)"/>
                                                <t t-foreach="evals" t-as="eval">
                                                   <t t-set="competences"
                                                      t-value="record_lines.filtered(lambda r: r.parent_line_id.id == eval.id)"/>
                                                   <t t-foreach="competences" t-as="competence">
                                                      <td t-foreach="competence.exam_ids" t-as="exam" t-att-class="'td_eval_' + exam.eval_type">
                                                         <t t-set="exam_record" t-value="student_record_lines.filtered(lambda r: r.exam_id.id == exam.id)"/>
                                                         <t t-foreach="exam_record" t-as="exr">
                                                            <span t-att-class="'mark_retake' if exr.is_retake_record else None">
                                                               <span t-att-class="'mark_fail' if exr.numeric_mark &lt; 5 else None">
                                                                  <input readonly="True" class="mark_input" t-att-id="exr.id" t-att-value="round(exr.numeric_mark, 2)" placeholder="Insert mark"/>
                                                                  <t t-call="education_evaluation_notebook_table.select_exceptionality">
                                                                     <t t-set="selected_record" t-value="exr.id"/>
                                                                     <t t-set="selected_exceptionality" t-value="exr.exceptionality"/>
                                                                  </t>
                                                                  <t t-if="exr.is_retake_record"><b>(REC)</b></t>
                                                               </span>
                                                            </span>
                                                            <hr t-if="len(exam_record)>1"/>
                                                         </t>
                                                      </td>
                                                      <td t-att-class="'comp_schedule_td td_eval_' + competence.eval_type">
                                                         <t t-set="comp_record" t-value="student_record_lines.filtered(lambda r: not r.exam_id and r.n_line_id.id == competence.id)"/>
                                                         <t t-foreach="comp_record" t-as="cr">
                                                            <span t-att-class="'partial_mark' + (' mark_fail' if cr.calculated_partial_mark &lt; 5 else '')">
                                                               <t t-esc="cr.calculated_partial_mark" t-options='{"widget": "float", "precision": 2}'/></span>
                                                            <span t-att-class="'mark_retake' if cr.is_retake_record else None">
                                                               <span t-att-class="'mark_fail' if cr.numeric_mark &lt; 5 else None">
                                                                  <input readonly="True" class="mark_input" t-att-id="cr.id" t-att-value="round(cr.numeric_mark, 2)" placeholder="Insert mark"/>
                                                                  <t t-call="education_evaluation_notebook_table.select_exceptionality">
                                                                     <t t-set="selected_record" t-value="cr.id"/>
                                                                     <t t-set="selected_exceptionality" t-value="cr.exceptionality"/>
                                                                  </t>
                                                                  <t t-if="cr.is_retake_record"><b>(REC)</b></t>
                                                               </span>
                                                            </span>
                                                            <hr t-if="len(comp_record)>1"/>
                                                         </t>
                                                      </td>
                                                   </t>
                                                   <td t-att-class="'eval_schedule_td final_td td_eval_' + eval.eval_type">
                                                      <t t-set="eval_record" t-value="student_record_lines.filtered(lambda r: r.n_line_id.id == eval.id)"/>
                                                      <t t-foreach="eval_record" t-as="er">
                                                         <span t-att-class="'partial_mark' + (' mark_fail' if er.calculated_partial_mark &lt; 5 else '')">
                                                            <t t-esc="er.calculated_partial_mark" t-options='{"widget": "float", "precision": 2}'/></span>
                                                         <span t-att-class="'mark_retake' if er.is_retake_record else None">
                                                            <span t-att-class="'mark_fail' if er.numeric_mark &lt; 5 else None">
                                                               <input readonly="True" class="mark_input" t-att-id="er.id" t-att-value="round(er.numeric_mark, 2)" placeholder="Insert mark"/>
                                                               <t t-call="education_evaluation_notebook_table.select_exceptionality">
                                                                  <t t-set="selected_record" t-value="er.id"/>
                                                                  <t t-set="selected_exceptionality" t-value="er.exceptionality"/>
                                                               </t>
                                                               <t t-if="er.is_retake_record"><b>(REC)</b></t>
                                                            </span>
                                                         </span>
                                                         <hr t-if="len(eval_record)>1"/>
                                                      </t>
                                                   </td>
                                                </t>
                                                <td t-att-class="'global_schedule_td final_td td_eval_' + line.eval_type">
                                                   <t t-set="global_record" t-value="student_record_lines.filtered(lambda r: r.n_line_id.id == line.id)"/>
                                                   <t t-foreach="global_record" t-as="gr">
                                                      <span t-att-class="'partial_mark' + (' mark_fail' if gr.calculated_partial_mark &lt; 5 else '')">
                                                         <t t-esc="gr.calculated_partial_mark" t-options='{"widget": "float", "precision": 2}'/></span>
                                                      <span t-att-class="'mark_retake' if gr.is_retake_record else None">
                                                         <span t-att-class="'mark_fail' if gr.numeric_mark &lt; 5 else None">
                                                            <input readonly="True" class="mark_input" t-att-id="gr.id" t-att-value="round(gr.numeric_mark, 2)" placeholder="Insert mark"/>
                                                            <t t-call="education_evaluation_notebook_table.select_exceptionality">
                                                               <t t-set="selected_record" t-value="gr.id"/>
                                                               <t t-set="selected_exceptionality" t-value="gr.exceptionality"/>
                                                            </t>
                                                            <t t-if="gr.is_retake_record"><b>(REC)</b></t>
                                                         </span>
                                                      </span>
                                                      <hr t-if="len(global_record)>1"/>
                                                   </t>
                                                </td>
                                             </t>
                                          </t>
                                       </tr>
                                    </t>
                                 </tbody>
                              </table>
                           </t>
                           <t t-else="">
                              <h2>
                                 No records found
                              </h2>
                           </t>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </xpath>
      </t>
   </template>
   <template id="select_exceptionality">
      <select t-att-class="'exceptionality_select select_disabled' + ' no_exceptionality' if not selected_exceptionality else ''" name="exceptionality_select" t-att-id="selected_record">
         <option value="">Select exceptionality</option>
         <t t-foreach="exceptionalities" t-as="exceptionality">
            <option t-att-value="exceptionality" t-att-selected="exceptionality == selected_exceptionality">
               <t t-esc="exceptionalities[exceptionality]"/>
            </option>
         </t>
      </select>
   </template>
</odoo>
