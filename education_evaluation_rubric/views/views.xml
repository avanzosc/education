<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="education_notebook_line_view_form" model="ir.ui.view">
        <field name="model">education.notebook.line</field>
        <field name="inherit_id" ref="education_evaluation_notebook.education_notebook_line_view_form"/>
        <field name="arch" type="xml">
            <button name="button_create_student_records" position="after">
                <button name="button_open_all_survey_inputs" string="Answer All Surveys" type="object" attrs="{'invisible': [('survey_input_count','=', 0)]}"/>
            </button>
            <div class="oe_button_box" name="button_box">
                <button name="action_survey_user_input" type="object"
                        class="oe_stat_button" icon="fa-pencil-square-o"
                        attrs="{'invisible': [('survey_input_count','=', 0)]}">
                    <field string="Answers" name="survey_input_count" widget="statinfo"/>
                </button>
            </div>
            <field name="task_type_id" position="after">
                <field name="eval_mode" invisible="1"/>
                <field name="edited_survey_show" invisible="1"/>
                <field name="course_ids" invisible="1"/>
                <field name="survey_id"
                       options='{"no_open": True}'
                       attrs="{'invisible':[('eval_mode','!=','rubric')]}"
                       domain="[
                            ('is_base_survey', '=', True),
                            '|',
                            ('responsible', '=', False),
                            ('responsible', '=', teacher_id),
                            '|',
                            ('competence_ids', '=', False),
                            ('competence_ids', 'in', competence_id),
                            '|',
                            ('level_ids', '=', False),
                            ('level_ids', 'in', level_ids),
                            '|',
                            ('subject_ids', '=', False),
                            ('subject_ids', 'in', subject_id),
                            '|',
                            ('education_course_ids', '=', False),
                            ('education_course_ids', 'in', course_ids)]"/>
                <button name="button_create_custom_survey"
                        confirm="By creating a custom survey template existing survey inputs will be deleted."
                        string="Create custom survey" type="object" attrs="{'invisible': ['|',('edited_survey_show','=', False),('edited_survey_id', '!=', False)]}"/>
                <field name="edited_survey_id"
                       attrs="{'invisible': [('edited_survey_show','=', False)]}"/>

            </field>
            <xpath expr="//field[@name='child_line_ids']/tree/field[@name='competence_type_id']" position="after">
                <field name="edited_survey_show" invisible="1"/>
                <field name="teacher_id" invisible="1"/>
                <field name="subject_id" invisible="1"/>
                <field name="course_ids" invisible="1"/>
                <field name="survey_id"
                       options='{"no_open": True}'
                       domain="[
                            ('is_base_survey', '=', True),
                            '|',
                            ('responsible', '=', False),
                            ('responsible', '=', teacher_id),
                            '|',
                            ('competence_ids', '=', False),
                            ('competence_ids', 'in', competence_id),
                            '|',
                            ('level_ids', '=', False),
                            ('level_ids', 'in', level_ids),
                            '|',
                            ('subject_ids', '=', False),
                            ('subject_ids', 'in', subject_id),
                            '|',
                            ('education_course_ids', '=', False),
                            ('education_course_ids', 'in', course_ids)]"/>
                <button name="button_create_custom_survey"
                        confirm="By creating a custom survey template existing survey inputs will be deleted."
                        string="Create custom survey" type="object" attrs="{'invisible': ['|',('edited_survey_show','=', True),('survey_id', '=', False)]}"/>
                <field name="edited_survey_id"
                       attrs="{'invisible': [('edited_survey_show','=', False)]}"/>

            </xpath>
        </field>
    </record>
    <record id="education_record_view_tree" model="ir.ui.view">
        <field name="model">education.record</field>
        <field name="inherit_id" ref="education_evaluation_notebook.education_record_view_tree"/>
        <field name="arch" type="xml">
            <field name="recovered_record_id" position="after">
                <field name="survey_input_id" invisible="1"/>
                <button name="button_respond_survey" string="Open survey"
                        type="object" icon="fa-pencil" help="Open"
                        attrs="{'invisible':[('survey_input_id','=',False)]}"/>
            </field>
        </field>
    </record>
    <record id="survey_form" model="ir.ui.view">
        <field name="model">survey.survey</field>
        <field name="inherit_id" ref="survey.survey_form"/>
        <field name="arch" type="xml">
            <field name="quizz_mode" position="after">
                <field name="is_base_survey"/>
                <field name="responsible"/>
                <field name="competence_ids" widget="many2many_tags"/>
                <field name="level_ids" widget="many2many_tags"/>
                <field name="education_course_ids" widget="many2many_tags"/>
                <field name="subject_ids" widget="many2many_tags"/>
            </field>
        </field>
    </record>
    <record id="survey_user_input_form" model="ir.ui.view">
        <field name="model">survey.user_input</field>
        <field name="inherit_id" ref="survey.survey_user_input_form"/>
        <field name="arch" type="xml">

            <!--<field name="quizz_mark" position="after">
                <field name="average_grade"/>
            </field>-->
            <field name="page_id" position="attributes">
                <attribute name="readonly">1</attribute>
            </field>
            <field name="question_id" position="attributes">
                <attribute name="readonly">1</attribute>
            </field>
            <field name="answer_type" position="attributes">
                <attribute name="readonly">1</attribute>
                <attribute name="invisible">1</attribute>
            </field>
            <field name="date_create" position="attributes">
                <attribute name="readonly">1</attribute>
            </field>
            <field name="quizz_mark" position="attributes">
                <attribute name="readonly">1</attribute>
            </field>
            <field name="skipped" position="attributes">
                <attribute name="readonly">1</attribute>
            </field>
            <field name="skipped" position="after">
                <field name="labels_ids" invisible="1"/>
                <field name="labels_ids_2" invisible="1"/>
                <field name="value_suggested_row"
                       options="{'no_create': True}"
                       domain="[
                            ('id', 'in', labels_ids_2)]"/>
                <field name="value_suggested"
                       options="{'no_create': True}"
                       domain="[
                            ('id', 'in', labels_ids)]"/>
            </field>
            <xpath expr="//tree" position="attributes">
                <attribute name="editable">bottom</attribute>
            </xpath>
            <xpath expr="//group" position="inside">
                <group>
                    <field name="education_record_id"/>
                    <field name="academic_year"/>
                    <field name="evaluation"/>
                    <field name="description"/>
                    <field name="subject_id"/>
                    <field name="education_center"/>
                </group>
            </xpath>
        </field>
    </record>
    <record id="survey_user_input_tree" model="ir.ui.view">
        <field name="model">survey.user_input</field>
        <field name="inherit_id" ref="survey.survey_user_input_tree"/>
        <field name="arch" type="xml">
            <field name="quizz_score" position="after">
                <field name="average_grade"/>
            </field>
        </field>
    </record>
    <record id="survey_question_text_form" model="ir.ui.view">
        <field name="model">survey.question</field>
        <field name="inherit_id" ref="survey.survey_question_form"/>
        <field name="arch" type="xml">
            <field name="quizz_mark" position="after">
                <field name="color"/>
            </field>
            <field name="labels_ids_2" position="after">
                <separator/>
                <label for="survey_text_ids" attrs="{'invisible': [('type', '!=', 'matrix')]}"/>
                <button name="create_survey_texts" type="object" string="Create survey texts"/>
                <field name="survey_text_ids" context="{'default_question_id_2': active_id}" attrs="{'invisible': [('type', '!=', 'matrix')]}">
                    <tree editable="bottom">
                        <field name="label_id_1"/>
                        <field name="label_id_2"/>
                        <field name="text"/>
                    </tree>
                </field>
            </field>
        </field>
    </record>
</odoo>
